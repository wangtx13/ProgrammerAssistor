klgain k l gain of a feature f is defined in terms of maxent max ent type feature+class feature s f f = f c klgain k l gain of a feature f is g f = kl k l p~ c ||q c kl k l p~ c ||q_f c where p~ is the empirical distribution according to the label distribution and q is the distribution from the imperfect classifier and q_f is the distribution from the imperfect classifier with f added and f's weight adjusted but none of the other weights adjusted klgain k l gain of a feature f is g f = sum_c g f c notation from della pietra lafferty 1997 p 4 p~ q alpha the weight of the new feature feature location value feature location index actually pretty lame smoothing based on ghost counts attempt some add hoc smoothing remove the +1 0 in the line above if not doing smoothing instanceweight instance weight = ilist getinstanceweight get instance weight i the below relies on labelweights label weights summing to 1 over all labels! if i < 500 out i= +i+ li= +li+ true= +truelabelweight+ +true label weight+ model= +modellabelweight +model label weight p fli += truelabelweight label weight * instanceweight instance weight / numinstances+1 num instances+1 q fli += modellabelweight model label weight * instanceweight instance weight / numinstances+1 num instances+1 /*
		double psum = 0 
		double qsum = 0 
		for i = 0 i < numclasses num classes i++ 
			for j = 0 j < numfeatures num features j++ {
				psum += p i j 
				qsum += q i j 
			}
		assert math abs psum 1 0 < 0 0001 psum not 1 0! psum= +psum+ qsum= +qsum 
		assert math abs qsum 1 0 < 0 0001 qsum not 1 0! psum= +psum+ qsum= +qsum 
*/ q = q e^{\alpha g} p 4 out calculating qeag q \omega = classifications i value / numinstances num instances following line now done before outside of loop over instances for fi = 0 fi < numfeatures num features fi++ qeag fi += modellabelweight model label weight * 1 0 assume that feature fi does not occur in fv and thus has value 0 exp alpha * 0 == 1 0 this factoring is possible because all features have value 1 0 * 1 0 out calculating klgain values klgains j += math abs alphas i j * p i j klgains j += math abs alphas i j 