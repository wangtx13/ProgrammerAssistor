{{{ imports }}} {{{ part {{{ getdisplaymanager get display manager /* an existing display manager's fold visibility map
		that a new display manager will inherit */ if we got here no unused display manager in list }}} {{{ release }}} {{{ bufferclosed buffer closed }}} {{{ textareadisposed text area disposed }}} }}} {{{ getbuffer get buffer }}} {{{ islinevisible is line visible }}} {{{ isoutsidenarrowing is outside narrowing if the line is beyond the last visible line it may still be within the narrowed display if the last visible line is a root for the fold containing the given line any line between the last visible and the given line with a fold level <= that of the last visible will break the root child relationship if we get to this point it means that the last visible line is a fold level root for the given line }}} {{{ getfirstvisibleline get first visible line }}} {{{ getlastvisibleline get last visible line }}} {{{ getnextvisibleline get next visible line }}} {{{ getprevvisibleline get prev visible line }}} {{{ getscreenlinecount get screen line count }}} {{{ getscrolllinecount get scroll line count }}} {{{ collapsefold collapse fold if the caret is on a collapsed fold collapse the parent fold {{{ find fold start and end this line is the start of a fold scan backwards looking for the start no folds in buffer }}} collapse the fold }}} {{{ expandfold expand fold }}} {{{ expandallfolds expand all folds }}} {{{ expandfolds expand folds }}} {{{ expandfolds expand folds keep track of the least fold level up to this point in the because we can't hide a line at this level since there will be no root line to unfold it from }}} {{{ expandfolds expand folds }}} {{{ narrow if we narrowed to a single collapsed fold }}} {{{ members {{{ init needs information available in textarea text area only when a displaymanager display manager is active in it init will be called later from bufferloaded buffer loaded already initialized just make the scroll bar updated }}} {{{ notifyscreenlinechanges notify screen line changes screen line change must be issued when the textarea text area has information of wrap mode for the buffer otherwise the screen line calculation will be incorrect fixme f i x m e why here? }}} {{{ setfirstline set first line }}} {{{ setfirstphysicalline set first physical line jedittextarea j edit text area scrollto scroll to needs this to simplify its nothing to do /* do nothing */ we have to be careful }}} {{{ invalidatescreenlinecounts invalidate screen line counts }}} {{{ updatescreenlinecount update screen line count if this displaymanager display manager is not current visible one screen line count can't be determined since the wrap mode and the wrap margin and chunkcache chunk cache for the buffer are not available maybe those information should be in displaymanager display manager instead of textarea text area reset chunk cache here }}} {{{ bufferloaded buffer loaded init will be called later when the buffer is set in the textarea text area }}} {{{ foldhandlerchanged fold handler changed happens once before bufferloaded buffer loaded is called it seems violating the javadoc on bufferlistener buffer listener but it's not a problem in displaymanager display manager because this is called later on init possibly via bufferloaded buffer loaded init will be called later when the buffer is set in the textarea text area }}} }}} {{{ members {{{ displaymanager display manager constructor todo t o d o elastictabstopbufferlistener elastic tab stop buffer listener from inside bufferhandler buffer handler to avoid chunking same line twice this listener priority thing is a bad hack }}} {{{ resetanchors reset anchors }}} {{{ dispose }}} {{{ showlinerange show line range for folding xxx x x x important not screenlinemgr screen line mgr getscreenlinecount get screen line count /* update fold visibility map */ }}} {{{ hidelinerange hide line range /* update fold visibility map */ }}} {{{ setscreenlinecount set screen line count }}} {{{ _expandfold if any fold farther up was unfolded then the text area needs to be updated at this point line is already visible but if the fully flag is set we may still need to look for and show its subfolds {{{ find fold start and fold end this line is the start of a fold }}} {{{ expand the fold }}} }}} {{{ mutableinteger mutable }}} }}} 