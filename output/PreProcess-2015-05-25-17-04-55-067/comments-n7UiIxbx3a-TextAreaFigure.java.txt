cache of the textfigure's text figure's layout strings split gettext get text '\n' assume styledtext styled text is an attributedcharacteriterator attributed character iterator and the number of tabs in styledtext styled text is tabcount tab count now tablocations tab locations has an entry for every tab's offset in the text for convenience the last entry is tablocations tab locations is the offset of the last character in the text lay out and draw each line all segments on a line must be computed before any drawing can occur since we must know the largest ascent on the line textlayouts text layouts are computed and stored in a list their horizontal positions are stored in a parallel list linecontainstext line contains text is after first segment is drawn layout can be if linecontainstext line contains text is move to next tab stop now iterate through layouts and draw them 