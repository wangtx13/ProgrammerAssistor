input_sequence_size + 1 input_sequence_size the model number of states in the lattice or the model's finite state machine ip input position each node has a forward and backward factor used in the forward backward algorithm indexed by ip state@ip state index / si subsequence constrained forward entropy run forward backward and compute the entropy add the entropy to expectations initialize entropy of start states to 0 position ip 1 in input sequence state a position ip in input sequence state a coming from state b p y_{ip 1}=b|y_{ip}=a initialize entropy of end states to 0 position ip 1 in input sequence state a position ip in input sequence state a p y_{ip}=b|y_{ip 1}=a this is obtained after substituting and re arranging the equation at the end of the third page of the paper into the equation of d/d_theta h y|x at the end of the second page \sum_ y_i y_{i+1} f_k y_i y_{i+1} x p y_i y_{i+1} * log p y_i y_{i+1} + h^a y_{1 i 1 } y_i + h^b y_{ i+2 t}|y_{i+1} full covariance note it could be positive *or* negative 